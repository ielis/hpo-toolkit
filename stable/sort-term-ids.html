<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sorting term IDs &mdash; hpo-toolkit 0.3.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/hpo-toolkit.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=e259d695"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=35a8b989"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API reference" href="apidocs/modules.html" />
    <link rel="prev" title="Use ontology hierarchy" href="use-hierarchy.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            hpo-toolkit
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="user-guide.html">User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="load-ontology.html">Load ontology</a></li>
<li class="toctree-l2"><a class="reference internal" href="use-hierarchy.html">Use ontology hierarchy</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Sorting term IDs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hierarchical-sorting">Hierarchical sorting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="apidocs/modules.html">API reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">hpo-toolkit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="user-guide.html">User guide</a></li>
      <li class="breadcrumb-item active">Sorting term IDs</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/sort-term-ids.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="sorting-term-ids">
<span id="sort-term-ids"></span><h1>Sorting term IDs<a class="headerlink" href="#sorting-term-ids" title="Link to this heading"></a></h1>
<p>Working with HPO typically includes working with items (e.g. patients) annotated with HPO terms.
However, the annotations are rarely sorted in any meaningful order which can obscure the interpretation.
HPO toolkit provides logic for sorting HPO terms such that the similar terms are located closer than the rest.</p>
<p>Let’s illustrate this on example. Suppose having a subject annotated with the following terms:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">subject</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">... </span>  <span class="s1">&#39;HP:0001744&#39;</span><span class="p">,</span>  <span class="c1"># Splenomegaly</span>
<span class="gp">... </span>  <span class="s1">&#39;HP:0020221&#39;</span><span class="p">,</span>  <span class="c1"># Clonic seizure</span>
<span class="gp">... </span>  <span class="s1">&#39;HP:0001238&#39;</span><span class="p">,</span>  <span class="c1"># Slender finger</span>
<span class="gp">... </span>  <span class="s1">&#39;HP:0011153&#39;</span><span class="p">,</span>  <span class="c1"># Focal motor seizure</span>
<span class="gp">... </span>  <span class="s1">&#39;HP:0002240&#39;</span>   <span class="c1"># Hepatomegaly</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">term_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">TermId</span><span class="o">.</span><span class="n">from_curie</span><span class="p">(</span><span class="n">curie</span><span class="p">)</span> <span class="k">for</span> <span class="n">curie</span> <span class="ow">in</span> <span class="n">subject</span><span class="p">)</span>
</pre></div>
</div>
<p>The order of HPO annotations does not reflect that <em>Splenomegaly</em> is more “similar” to <em>Hepatomegaly</em> than
to <em>Clonic seizure</em>. The implementations of <a class="reference internal" href="apidocs/hpotk.util.sort.html#hpotk.util.sort.TermIdSorting" title="hpotk.util.sort.TermIdSorting"><code class="xref py py-class docutils literal notranslate"><span class="pre">hpotk.util.sort.TermIdSorting</span></code></a> endeavor to improve on this.</p>
<p>The sorting logic is handled by <a class="reference internal" href="apidocs/hpotk.util.sort.html#hpotk.util.sort.TermIdSorting" title="hpotk.util.sort.TermIdSorting"><code class="xref py py-class docutils literal notranslate"><span class="pre">hpotk.util.sort.TermIdSorting</span></code></a> implementations. The algorithm takes
a sequence of term IDs or <a class="reference internal" href="apidocs/hpotk.model.html#hpotk.model.Identified" title="hpotk.model.Identified"><code class="xref py py-class docutils literal notranslate"><span class="pre">hpotk.model.Identified</span></code></a> entities, such as <a class="reference internal" href="apidocs/hpotk.model.html#hpotk.model.Term" title="hpotk.model.Term"><code class="xref py py-class docutils literal notranslate"><span class="pre">hpotk.model.Term</span></code></a>, and returns
indices for sorting the input sequence - the same what <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.argsort.html#numpy.argsort" title="(in NumPy v1.25)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.argsort()</span></code></a> does.</p>
<section id="hierarchical-sorting">
<h2>Hierarchical sorting<a class="headerlink" href="#hierarchical-sorting" title="Link to this heading"></a></h2>
<p><a class="reference internal" href="apidocs/hpotk.util.sort.html#hpotk.util.sort.HierarchicalSimilaritySorting" title="hpotk.util.sort.HierarchicalSimilaritySorting"><code class="xref py py-class docutils literal notranslate"><span class="pre">hpotk.util.sort.HierarchicalSimilaritySorting</span></code></a> sorts the term IDs using a combination of hierarchical
clustering and Resnik semantic similarity. The algorithm iteratively chooses the most similar term ID pairs
and places them into adjacent locations.</p>
<p>The sorting needs HPO graph and a callable for getting an information content (IC) of an ontology term.
We’ll use a toy HPO with several terms and information content of terms prepared using
<a class="reference internal" href="apidocs/hpotk.algorithm.similarity.html#hpotk.algorithm.similarity.calculate_ic_for_annotated_items" title="hpotk.algorithm.similarity.calculate_ic_for_annotated_items"><code class="xref py py-func docutils literal notranslate"><span class="pre">hpotk.algorithm.similarity.calculate_ic_for_annotated_items()</span></code></a>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">hpo</span> <span class="o">=</span> <span class="n">hpotk</span><span class="o">.</span><span class="n">load_minimal_ontology</span><span class="p">(</span><span class="s1">&#39;data/hp.toy.json&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/hp.toy.ic.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
<span class="gp">... </span>  <span class="n">ic_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ic_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">TermId</span><span class="o">.</span><span class="n">from_curie</span><span class="p">(</span><span class="n">curie</span><span class="p">):</span> <span class="n">ic</span> <span class="k">for</span> <span class="n">curie</span><span class="p">,</span> <span class="n">ic</span> <span class="ow">in</span> <span class="n">ic_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">ic_source</span><span class="p">(</span><span class="n">term_id</span><span class="p">:</span> <span class="n">TermId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">ic_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">term_id</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can instantiate <cite>HierarchicalSimilaritySorting</cite>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hpotk.util.sort</span> <span class="kn">import</span> <span class="n">HierarchicalSimilaritySorting</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">sorting</span> <span class="o">=</span> <span class="n">HierarchicalSimilaritySorting</span><span class="p">(</span><span class="n">hpo</span><span class="p">,</span> <span class="n">ic_source</span><span class="p">)</span>
</pre></div>
</div>
<p>And sort the HPO terms:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">indices</span> <span class="o">=</span> <span class="n">sorting</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">term_ids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ordered</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">term_ids</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">)</span>
</pre></div>
</div>
<p>Now let’s look at the order:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">term_id</span> <span class="ow">in</span> <span class="n">ordered</span><span class="p">:</span>
<span class="gp">... </span>  <span class="nb">print</span><span class="p">(</span><span class="n">hpo</span><span class="o">.</span><span class="n">get_term</span><span class="p">(</span><span class="n">term_id</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="go">Hepatomegaly</span>
<span class="go">Splenomegaly</span>
<span class="go">Focal motor seizure</span>
<span class="go">Clonic seizure</span>
<span class="go">Slender finger</span>
</pre></div>
</div>
<p>which is much better, right?</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="use-hierarchy.html" class="btn btn-neutral float-left" title="Use ontology hierarchy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="apidocs/modules.html" class="btn btn-neutral float-right" title="API reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Daniel Danis.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>